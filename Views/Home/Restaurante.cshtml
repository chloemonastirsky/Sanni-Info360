@{
    Layout = "_Layout";
}

@* 1. Encabezado del Restaurante *@
@if (ViewBag.Restaurante != null)
{
    <h2>@ViewBag.Restaurante.nombre</h2>
    <hr />
}
else
{
    <h2>Resultados de Restaurante</h2>
}

@* 2. Platos Disponibles *@
<h3>Platos Disponibles</h3>
@if (ViewBag.PlatosRestaurante != null && ViewBag.PlatosRestaurante.Count > 0)
{
    @foreach (var p in ViewBag.PlatosRestaurante)
    {
        <div class="item-plato">
            <a class="btn btn-primary" href='@Url.Action("verPlato", "Home", new {idPlato= p.idPlato})'>
                @p.nombre
            </a>
            
            <p><strong>Descripción:</strong> @p.descripcion</p>
            <p><strong>Calorías:</strong> @p.calorias</p>
            <p><strong>Precio:</strong> $@p.precio</p>
        </div>
        <br/>
    }
}
else
{
    <p>No se encontraron platos para este restaurante.</p>
}

@* 3. Bebidas Disponibles *@
<h3>Bebidas Disponibles</h3>
@if (ViewBag.BebidasRestaurante != null && ViewBag.BebidasRestaurante.Count > 0)
{
    @foreach (var b in ViewBag.BebidasRestaurante)
    {
        <div class="item-bebida">
            <a class="btn btn-primary" href='@Url.Action("verBebida", "Home", new {idBebida= b.idBebida})'>
                @b.nombre
            </a>
            
            <p><strong>Descripción:</strong> @b.descripcion</p>
        </div>
        <br/>
    }
}
else
{
    <p>No se encontraron bebidas para este restaurante.</p>
}

@* 4. Contenedor HTML del Mapa *@
@if (ViewBag.Restaurante != null)
{
    <h3 class="mt-4">Ubicación de @ViewBag.Restaurante.nombre</h3>
    <div id="mapa" style="height: 350px; width: 100%; margin-bottom: 20px;"></div>
}

<div id="map" style="height: 400px; width: 100%;"></div>

<script>
    // ✅ 1. Obtenemos el objeto de un solo restaurante desde el ViewBag.
    // Asumimos que ViewBag.Restaurante es un objeto con propiedades 'latitud', 'longitud' y 'nombre'.
    const restaurante = @Html.Raw(ViewBag.Restaurante); 
    
    let map;

    window.initMap = function () {
        
        // Verificación básica de que los datos existen y son válidos
        if (!restaurante || !restaurante.latitud || !restaurante.longitud) {
            console.error("Error: No se encontraron datos de latitud/longitud del restaurante.");
            document.getElementById("map").innerHTML = "<p>Ubicación no disponible.</p>";
            return;
        }

        const ubicacion = { lat: restaurante.latitud, lng: restaurante.longitud };

        // ✅ 2. Inicializamos el mapa centrado en la ubicación específica del restaurante.
        map = new google.maps.Map(document.getElementById("map"), {
            center: ubicacion,
            zoom: 16, // Un zoom más alto para ver la ubicación específica
            mapTypeControl: false, // Opcional: para limpiar la interfaz
            streetViewControl: false,
        });

        // ✅ 3. Cargamos el marcador único.
        cargarMarcador(ubicacion, restaurante.nombre);
    };

    /**
     * Carga un único marcador en el mapa.
     * @param {object} ubicacion - Objeto { lat: number, lng: number } con las coordenadas.
     * @param {string} nombre - Nombre del restaurante para el título del marcador.
     */
    function cargarMarcador(ubicacion, nombre) {
        
        // Crear el marcador
        const marker = new google.maps.Marker({
            position: ubicacion,
            map: map,
            title: nombre,
            // Opcional: Puedes usar un icono diferente o personalizado
            icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png' 
        });

        // Opcional: Añadir una ventana de información (InfoWindow)
        const infoWindow = new google.maps.InfoWindow({
            content: `<h6>${nombre}</h6>`
        });

        marker.addListener("click", () => {
            infoWindow.open(map, marker);
        });
        
        // Abrir la InfoWindow por defecto al cargar
        infoWindow.open(map, marker); 
    }

    // ✅ Eliminamos todas las funciones de manejo de listas y filtros (cargarMarcadores, filtrarUbicaciones, actualizarPanelCampanas).

</script>

@* Script de la API de Google Maps con la clave. *@@* Mantenemos el callback=initMap para que la API se inicialice al cargar. *@
<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHo2Nt4gu8COeh6PahmHc-QGsDPkzWWjs&callback=initMap"></script>
}