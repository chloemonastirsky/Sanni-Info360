@{
    Layout = "_Layout";
}

@* 1. Encabezado del Restaurante *@
@if (ViewBag.Restaurante != null)
{
    <h2>@ViewBag.Restaurante.nombre</h2>
    <hr />
}
else
{
    <h2>Resultados de Restaurante</h2>
}

@* 2. Platos Disponibles *@
<h3>Platos Disponibles</h3>
@if (ViewBag.PlatosRestaurante != null && ViewBag.PlatosRestaurante.Count > 0)
{
    @foreach (var p in ViewBag.PlatosRestaurante)
    {
        <div class="item-plato">
            <a class="btn btn-primary" href='@Url.Action("verPlato", "Home", new {idPlato= p.idPlato})'>
                @p.nombre
            </a>
            
            <p><strong>Descripci√≥n:</strong> @p.descripcion</p>
            <p><strong>Calor√≠as:</strong> @p.calorias</p>
            <p><strong>Precio:</strong> $@p.precio</p>
        </div>
        <br/>
    }
}
else
{
    <p>No se encontraron platos para este restaurante.</p>
}

@* 3. Bebidas Disponibles *@
<h3>Bebidas Disponibles</h3>
@if (ViewBag.BebidasRestaurante != null && ViewBag.BebidasRestaurante.Count > 0)
{
    @foreach (var b in ViewBag.BebidasRestaurante)
    {
        <div class="item-bebida">
            <a class="btn btn-primary" href='@Url.Action("verBebida", "Home", new {idBebida= b.idBebida})'>
                @b.nombre
            </a>
            
            <p><strong>Descripci√≥n:</strong> @b.descripcion</p>
        </div>
        <br/>
    }
}
else
{
    <p>No se encontraron bebidas para este restaurante.</p>
}

@* 4. Contenedor HTML del Mapa *@
@if (ViewBag.Restaurante != null)
{
    <h3 class="mt-4">Ubicaci√≥n de @ViewBag.Restaurante.nombre</h3>
    <div id="mapa" style="height: 350px; width: 100%; margin-bottom: 20px;"></div>
}

<script>
  let map;
  let markers = [];

  const ubicaciones = @Html.Raw(ViewBag.Restaurante);

  window.initMap = function () {
    map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: -34.6089, lng: -58.4311 },
      zoom: 13,
    });

    cargarMarcadores(ubicaciones);

    // üî• AGREGADO ‚Äî escuchar cambios en los radios
    document.querySelectorAll('.donar-panel input[type="radio"]').forEach(r => {
        r.addEventListener("change", () => {
            filtrarUbicaciones(r.id);
        });
    });
  };

  function cargarMarcadores(lista) {
    markers.forEach(m => m.setMap(null));
    markers = [];

    lista.forEach(u => {
      const marker = new google.maps.Marker({
        position: { lat: u.latitud, lng: u.longitud },
        map,
        title: u.titulo,
        icon: {
          path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
          scale: 5,
          strokeColor: "#0112EB",
          rotation: 180 
        }
      });

      markers.push(marker);
    });
  }

function filtrarUbicaciones(categoria) {

    fetch(`/Home/FiltrarUbicaciones?categoria=${categoria}`)
      .then(r => r.json())
      .then(data => {
          cargarMarcadores(data);

          // üî• NUEVO: tambi√©n actualizamos el panel
          fetch(`/Home/FiltrarCampanas?categoria=${categoria}`)
            .then(r => r.json())
            .then(listaCampanas => {
                actualizarPanelCampanas(listaCampanas);
            });
      });
}
  function actualizarPanelCampanas(lista) {
    const contenedor = document.querySelector(".donar-panel-campana");

    contenedor.innerHTML = `
        <h2>Campa√±as</h2>
    `;

    if (lista.length === 0) {
        contenedor.innerHTML += `<p>No hay campa√±as para esta categor√≠a.</p>`;
        return;
    }

    lista.forEach(item => {
        contenedor.innerHTML += `
            <div class="campana-item">
                <p>${item.titulo}</p>
                <a class="btn-vermas btn-vermas-campana" href="/Home/ViewCampana">Ver Mas</a>
            </div>
        `;
    });
}
</script>

<script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHo2Nt4gu8COeh6PahmHc-QGsDPkzWWjs&callback=initMap"></script>
}