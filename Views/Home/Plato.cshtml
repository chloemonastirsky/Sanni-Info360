@* Views/Home/VerPlato.cshtml *@

@{
    Layout = "_Layout";
    // Solo definimos la variable 'plato'
    var plato = ViewBag.Plato; 
    
    // Variables temporales para el caso de que el plato no se encuentre
    decimal precioFinal = 0.0m;
}

@if (plato != null)
{
    // Mover TODA la l√≥gica de inicializaci√≥n y c√°lculo que usa 'plato' aqu√≠:
    
    // Asignaci√≥n de datos (usando null-conditional operators ?. si es posible, 
    // pero para simplicidad, lo haremos solo si plato != null)
    int calorias = plato.calorias;
    // Ajusta estos valores seg√∫n las propiedades de tu modelo Plato si existen
    int proteinas = 40; 
    int carbohidratos = 40; 
    int fibra = 10; 
    int grasas = 10; 

    // L√≥gica de c√°lculo del precio con descuento (dto)
    // Asegurarse de que dto sea al menos 0 para evitar errores.
    decimal descuento = (plato.dto > 0) ? (decimal)plato.dto / 100.0m : 0.0m;
    precioFinal = (decimal)plato.precio * (1 - descuento);
    
    // ------------------------------------------------------------------
    // AHORA EMPIEZA EL HTML DENTRO DEL IF
    // ------------------------------------------------------------------
    <div class="container my-4">
        
        <div class="row justify-content-center mb-4">
            <div class="col-lg-8 col-md-10">
                <div class="d-flex flex-column align-items-center bg-light p-4 rounded-3 shadow-sm" style="background-color: #fcf8e3;">
                    <h3 class="fw-bold">@ViewBag.nombreRestaurante</h3>
                    <div class="text-warning fs-4">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
                    </div>
                    <small class="text-muted">Entrega en: x min - Precio del env√≠o: $$</small>
                </div>
            </div>
        </div>

        <div class="row justify-content-center mb-5">
            <div class="col-lg-8 col-md-10 d-flex justify-content-around">
                <a href="#" class="btn btn-sm btn-success rounded-pill">Comidas</a>
                <a href="#" class="btn btn-sm btn-success rounded-pill">Favoritos</a>
                <a href="#" class="btn btn-sm btn-success rounded-pill">Promos</a>
                <a href="#" class="btn btn-sm btn-success rounded-pill">Destacados</a>
            </div>
        </div>

        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">
                <div class="card p-3 p-md-4 shadow-lg border-0">
                    <div class="text-center">
                        
                        <img src="@Url.Content(plato.foto)" alt="@plato.nombre" 
                             class="img-fluid rounded-3 mb-3" style="max-height: 300px; width: auto; object-fit: cover;">
                        <h2 class="fw-bold mt-3" style="color: #4CAF50;">@plato.nombre</h2>
                        
                        @* Iconos de restricci√≥n: Apto Vegano, Sin TACC, etc. (ajusta seg√∫n tus reglas) *@
                        <p class="text-center my-2">
                             <span class="badge bg-secondary me-2">üë®‚Äçüç≥</span>
                             <span class="badge bg-secondary me-2">üö´üåæ</span>
                             <span class="badge bg-secondary me-2">üå±</span>
                        </p>
                        
                        @* L√≥gica de Precio y Descuento *@
                        <h3 class="fw-bolder mb-3">
                            $@precioFinal.ToString("N0")
                            @if (plato.dto > 0)
                            {
                                <small class="text-decoration-line-through text-muted fs-6 ms-2">$@plato.precio.ToString("N0")</small>
                            }
                        </h3>
                        
                        <p class="text-muted px-4">@plato.descripcion</p>
                        
                        <div class="d-flex flex-wrap justify-content-center gap-2 my-4">
                            <span class="badge text-dark fw-bold p-2" style="background-color: #fdd835;">Cals @calorias</span>
                            <span class="badge text-dark fw-bold p-2" style="background-color: #fdd835;">Prote @proteinas gr</span>
                            <span class="badge text-dark fw-bold p-2" style="background-color: #fdd835;">Carbs @carbohidratos gr</span>
                            <span class="badge text-dark fw-bold p-2" style="background-color: #fdd835;">Fibra @fibra gr</span>
                            <span class="badge text-dark fw-bold p-2" style="background-color: #fdd835;">Grasas @grasas gr</span>
                        </div>
                        
                        <div class="d-grid gap-2 mx-auto" style="max-width: 80%;">
                            <button class="btn btn-lg fw-bold" style="background-color: #4CAF50; color: white;">
                                ¬°CUP√ìN!
                            </button>
                        </div>

                    </div>
                </div>
            </div> @* <--- CIERRE DE COL *@
        </div> @* <--- CIERRE DE ROW *@
        
    </div> @* <--- CIERRE DE CONTAINER *@
}
else
{
    <div class="container my-5 text-center">
        <div class="alert alert-danger" role="alert">
            <h4 class="alert-heading">¬°Plato no encontrado!</h4>
            <p>El identificador del plato es incorrecto o la informaci√≥n no est√° disponible.</p>
        </div>
        <a href='@Url.Action("Index", "Home")' class="btn btn-primary">Ir a la p√°gina principal</a>
    </div>
}